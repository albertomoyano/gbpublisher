\documentclass{book}

% Deben cargarse temprano para parches de macros
\usepackage{etoolbox}
\usepackage{ifthen}
\usepackage{calc}
\usepackage{booktabs}
\usepackage{indentfirst}
\usepackage{qrcode}

\usepackage{linebreaker}
\linebreakersetup{maxtolerance=90, maxemergencystretch=1em, maxcycles=4}

% Centrado y versalita de autores de capítulos
\newcommand\nombreautor[1]{\textsc{\MakeLowercase{#1}}}

% Rediseñamos la raya de las notas a pie aumentamos la distancia de la raya
\renewcommand{\footnoterule}{%
	\kern -3pt%
	\hrule height 0.5pt width 0.4\columnwidth%
	\kern 6pt%
}

% Cambiamos el modelo de numeracion de parte
\renewcommand\thepart{\arabic{part}}

% Cita con cambio de tamaño tipografico
\renewenvironment{quote}
{\normalsize\list{}{\sf\leftmargin=14pt \rightmargin=0pt}%
	\item\relax}
{\endlist}

% Diseño del pie de página
\usepackage[bottom,stable,hang]{footmisc}
\interfootnotelinepenalty=0

% Cambia el valor deseado en puntos (pt)
\setlength{\footnotesep}{10pt}

\makeatletter
\patchcmd\@footnotetext{\@MM}{100}{}{\fail}
\makeatother

% Tamaño del cuerpo del texto del footnote
\makeatletter
\patchcmd{\@footnotetext}{\footnotesize}{\small}{}{}
\makeatother

% Tamaño del cuerpo de puntero del footnote
\renewcommand*{\thefootnote}{\scriptsize\sf{[\arabic{footnote}]}}

\usepackage[labelfont=bf,font=small,labelsep=period,format=plain]{caption}

% Ornamenta para salida a pdf solamente
\usepackage{froufrou}

% Citas automáticas con estilo idiomático correcto
\usepackage[autostyle=true]{csquotes}

% Configuración geométrica de la página
\usepackage[paperwidth=155mm,
paperheight=230mm,
textwidth=110mm,
textheight=540pt,
centering,
includehead,
includefoot,
headsep=14pt,
top=35pt,
footskip=0mm,
footnotesep=14pt plus 0.1pt minus 0.1pt]{geometry}

% Diseño de listas
\usepackage{enumitem}
\setlist{nosep,topsep=4pt}
\setlength{\parindent}{1.5em}

% Configuración de idioma
\usepackage[french,portuguese,italian,english,german,spanish,es-ucroman,es-noshorthands]{babel}

% Personalización del nombre del índice
\renewcommand{\spanishcontentsname}{Sumario}

% cambiamos el nombre de sigla
\newcommand{\acronymsname}{Índice de siglas}

% Ajustes varios
\frenchspacing
\raggedbottom
\clubpenalty=10000
\widowpenalty=10000
%\setcounter{tocdepth}{0}
\setcounter{secnumdepth}{4}

\usepackage{graphicx}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother

% Paquetes varios
\usepackage{xcolor}
\usepackage{qrcode}
\usepackage{nccfoots}
\usepackage{rotating}
\usepackage{svg}
\usepackage[final]{pdfpages}
\usepackage{ragged2e}
\usepackage[framemethod=tikz]{mdframed}
\usepackage[most]{tcolorbox}

%% Mejoras tipográficas para fuentes OpenType
\usepackage{fontspec}
\usepackage{microtype}
\microtypesetup{protrusion=true, expansion=true, babel=true, tracking=true, activate={true,nocompatibility}}
\renewcommand{\normalsize}{\fontsize{10pt}{14pt}\selectfont}
\topskip=14pt

% Fuente principal Libertinus con características tipográficas
\setmainfont[Numbers={OldStyle,Proportional},Ligatures={TeX,Common,Discretionary},Scale=1.18]{Libertinus Serif}
\setsansfont[Scale=MatchLowercase,
Ligatures=TeX,
Extension=.otf,
UprightFont=*-Regular,
ItalicFont=*-Italic,
BoldFont=*-SemiBold,
BoldItalicFont=*-SemiBoldItalic]{IBMPlexSansCondensed}
\setmonofont[Scale=0.91,
Extension=.otf,
UprightFont=*-Regular,
ItalicFont = IBMPlexMono-Italic.otf,
BoldFont = IBMPlexMono-Bold.otf,
BoldItalicFont = IBMPlexMono-BoldItalic.otf]{IBMPlexMono.otf}

%% Matemáticas con Libertinus Math
%\usepackage{unicode-math}
%\setmathfont{Libertinus Math}[Scale=MatchLowercase]

% Configuración de fuentes para chino
% \usepackage{luatexja-fontspec}
% \setmainjfont{FandolSong}

\usepackage{titletoc}
% partes
\titlecontents{part}[0em]
{\addvspace{5pt}\sf\bfseries\normalsize\selectfont\filright}
{\contentslabel[\thecontentslabel]{2.5pc}}{}{}

% capitulo
\titlecontents{chapter}[1.5pc]
{\addvspace{.4em}\sf\selectfont\filright}
{\contentslabel{1.5pc}}
{\hspace*{-1.5pc}}%
{\titlerule*[1pc]{.}\contentspage[\hspace*{-4pc} {\rm\small\thecontentspage}]}%
[]

\titlecontents{section}[4.5pc]
{\small\filright}
{\contentslabel{2.5pc}}
{\hspace*{-2.5pc}}
{\titlerule*[1pc]{.}\contentspage}

\usepackage[sf,bf,compact,topmarks,calcwidth,pagestyles,clearempty,newlinetospace]{titlesec}
%diseño de parte
\makeatletter
\def\@part[#1]#2{%
	\ifnum \c@secnumdepth >-2\relax
	\refstepcounter{part}%
	\addcontentsline{toc}{part}{Parte \thepart\hspace{1em}#1}%
	\else
	\addcontentsline{toc}{part}{#1}%
	\fi
	\markboth{}{}%
	{\centering
		\interlinepenalty \@M
		\ifnum \c@secnumdepth >-2\relax
		\sf\LARGE\selectfont \partname~\thepart
		\par\vskip 20\p@%
		\fi
		\sf\Large\selectfont
		#2\par}%
	\@endpart}

\def\@spart#1{%
	\markboth{}{}%
	{\centering
		\interlinepenalty \@M
		\sf\LARGE\selectfont
		#1\par}%
	\@endpart}
\makeatother

%diseño de capitulo
\titleformat{\chapter}[display]
{\Large}
{\vspace{-2.5cm}\centering{\textsc{\MakeLowercase\chaptertitlename}}~\thechapter}
{1.5cm}
{\filright\sf\LARGE}
[]

%diseño de seccion
\titleformat{\section}[hang]
{\sf\bfseries\large\raggedright}
{\thesection}{.5em}{}[]
\titlespacing{\section}
{\parindent}{18pt plus 0.5pt minus 0.5pt}{6.75pt}

%diseño de subseccion
\titleformat{\subsection}[hang]
{\sf\large\raggedright}
{\thesubsection}{.5em}{}[]
\titlespacing{\subsection}
{\parindent}{18pt plus 0.5pt minus 0.5pt}{6.75pt}

%diseño de subsubseccion
\titleformat{\subsubsection}[hang]
{\rm\bfseries\normalsize\raggedright}
{\thesubsubsection}{.5em}{}[]
\titlespacing{\subsubsection}
{\parindent}{18pt plus 0.5pt minus 0.5pt}{6.75pt}

%diseño de parrafo para usar con los autores de compilaciones
\titleformat{\paragraph}[runin]
{\bfseries}
{}{0em}{}
[\mbox{ --- }]
\titlespacing{\paragraph}
{0pt}% antes de la raya
{6.75pt plus 0.5pt minus 0.5pt}% antes del párrafo
{0pt}% después de la raya

%diseño de subparrafo
\titleformat{\subparagraph}[hang]
{\sf\bfseries\large\centering}
{\thesubparagraph}{.5em}{}[]
\titlespacing{\subparagraph}
{\parindent}{18pt plus 0.5pt minus 0.5pt}{6.75pt}

% Diseño de cabezales
\renewpagestyle{plain}[]{%
	\setfoot{}{}{}}
\newpagestyle{myps}[]{%
	\setfoot[][][]{}{}{}
	\sethead[\sf \textbf{\usepage}][][\sf \TheAuthor]
	{\sf \chaptertitle}{}{\sf \textbf{\usepage}}
}
\pagestyle{myps}

\newcommand{\TheAuthor}{}
\newcommand{\Author}[1]{\renewcommand{\TheAuthor}{#1}}

% Cambiamos parametros para corte de url
\usepackage{url}
\Urlmuskip = 0mu plus 1mu
\def\UrlBreaks{\do\a\do\b\do\c\do\d\do\e\do\f\do\g\do\h\do\i\do\j\do\k\do\l\do\m\do\n\do\o\do\p\do\q\do\r\do\s\do\t\do\u\do\v\do\w\do\x\do\y\do\z\do\A\do\B\do\C\do\D\do\E\do\F\do\G\do\H\do\I\do\J\do\K\do\L\do\M\do\N\do\O\do\P\do\Q\do\R\do\S\do\T\do\U\do\V\do\W\do\X\do\Y\do\Z\do0\do1\do2\do3\do4\do5\do6\do7\do8\do9\do=\do.\do:\do\%\do?\do_\do-\do+\do/\do\#\do~}
\def\UrlFont{\rm}

% Entorno CSLReferences con sangría colgante tipo APA
\newlength{\cslhangindent}
\setlength{\cslhangindent}{1.5em}

\newenvironment{CSLReferences}[2]
{
	\setlength{\parindent}{0pt}
	\setlength{\parskip}{0pt}
	\everypar{\hangindent=\cslhangindent\hangafter=1}
}
{}

\usepackage{hyperref}
\hypersetup{
colorlinks=true,
linkcolor=magenta,
filecolor=magenta,
urlcolor=magenta,
citecolor=magenta,
bookmarks=true,
bookmarksopen=false,
bookmarksnumbered=true,
hidelinks=false}

\begin{document}

$if(toc)$
{
	\hypersetup{linkcolor=$if(toccolor)$$toccolor$$else$black$endif$}
	\setcounter{tocdepth}{$toc-depth$}
	\tableofcontents
}
$endif$

$body$

\end{document}
