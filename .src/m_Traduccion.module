' Gambas module file

' CLAVES DE CONFIGURACIÓN
Private Const CONFIG_DEEPL_KEY As String = "Traduccion/DeepL_ApiKey"
Private Const CONFIG_AZURE_KEY As String = "Traduccion/Azure_ApiKey"
Private Const CONFIG_AZURE_REGION As String = "Traduccion/Azure_Region"
Private Const CONFIG_MOTOR_PREDETERMINADO As String = "Traduccion/MotorPredeterminado"

' MOSTRAR FORMULARIO DE TRADUCCIÓN
Public Sub MostrarFormulario(sTextoSeleccionado As String)

  Dim hForm As FTraducir

  ' VALIDAR QUE HAY TEXTO SELECCIONADO
  If Not Trim(sTextoSeleccionado) Then
    Message.Info("Seleccione texto antes de traducir.")
    Return
  Endif

  ' LIMITAR A 5000 CARACTERES
  If Len(sTextoSeleccionado) > 5000 Then
    Message.Warning("El texto seleccionado excede los 5000 caracteres permitidos.")
    Return
  Endif

  ' CREAR Y MOSTRAR EL FORMULARIO
  hForm = New FTraducir
  hForm.TextoSeleccionado = sTextoSeleccionado
  hForm.ShowModal()

End

' =============================================================================
' OBTENER API KEY DE DEEPL
' =============================================================================

Public Function ObtenerDeepLKey() As String

  Return Settings[CONFIG_DEEPL_KEY, ""]

End

' =============================================================================
' ESTABLECER API KEY DE DEEPL
' =============================================================================

Public Sub EstablecerDeepLKey(sKey As String)

  Settings[CONFIG_DEEPL_KEY] = sKey

End

' =============================================================================
' OBTENER API KEY DE AZURE
' =============================================================================

Public Function ObtenerAzureKey() As String

  Return Settings[CONFIG_AZURE_KEY, ""]

End

' =============================================================================
' ESTABLECER API KEY DE AZURE
' =============================================================================

Public Sub EstablecerAzureKey(sKey As String)

  Settings[CONFIG_AZURE_KEY] = sKey

End

' =============================================================================
' OBTENER REGIÓN DE AZURE
' =============================================================================

Public Function ObtenerAzureRegion() As String

  Return Settings[CONFIG_AZURE_REGION, ""]

End

' =============================================================================
' ESTABLECER REGIÓN DE AZURE
' =============================================================================

Public Sub EstablecerAzureRegion(sRegion As String)

  Settings[CONFIG_AZURE_REGION] = sRegion

End

' =============================================================================
' OBTENER MOTOR PREDETERMINADO
' =============================================================================

Public Function ObtenerMotorPredeterminado() As String

  Return Settings[CONFIG_MOTOR_PREDETERMINADO, "DeepL Free"]

End

' =============================================================================
' ESTABLECER MOTOR PREDETERMINADO
' =============================================================================

Public Sub EstablecerMotorPredeterminado(sMotor As String)

  Settings[CONFIG_MOTOR_PREDETERMINADO] = sMotor

End

' =============================================================================
' VERIFICAR CONFIGURACIÓN DE APIS
' =============================================================================
' VERIFICA QUE AL MENOS UN MOTOR TENGA SUS CREDENCIALES CONFIGURADAS
' RETORNA TRUE SI HAY AL MENOS UN MOTOR DISPONIBLE
' =============================================================================

Public Function VerificarConfiguracion() As Boolean

  ' DEEPL REQUIERE API KEY
  If ObtenerDeepLKey() Then
    Return True
  Endif

  ' AZURE REQUIERE API KEY
  If ObtenerAzureKey() Then
    Return True
  Endif

  Return False

End

' =============================================================================
' OBTENER LISTA DE MOTORES DISPONIBLES
' =============================================================================
' RETORNA UN ARRAY CON LOS NOMBRES DE LOS MOTORES QUE TIENEN
' SUS CREDENCIALES CONFIGURADAS
' =============================================================================

Public Function ObtenerMotoresDisponibles() As String[]

  Dim aMotores As New String[]

  ' DEEPL (DISPONIBLE SI HAY API KEY)
  If ObtenerDeepLKey() Then
    aMotores.Add("DeepL Free")
  Endif

  ' AZURE (DISPONIBLE SI HAY API KEY)
  If ObtenerAzureKey() Then
    aMotores.Add("Azure Translator")
  Endif

  Return aMotores

End