' Gambas class file

Private Contenido As Result

Public Sub Form_Open()

  ' Limpiar campos al inicio
  LimpiarCampos()

  With TableViewAdministracion
    .Header = True
    .Grid = True
    .Columns.Count = 62

    ' Configuración de columnas
    For i As Integer = 0 To 61
      Select Case i
        Case 3
          .Columns[i].Title = "Título"
          .Columns[i].Width = 600
        Case 48
          .Columns[i].Title = "Autoría"
          .Columns[i].Width = 300
        Case Else
          .Columns[i].Title = ""
          .Columns[i].Width = 0
      End Select
    Next
  End With

  CargarGridAdmin()

End

Public Sub ButtonCerrarAdmin_Click()

  Me.Close

End

' Función para limpiar los campos de texto
Public Sub LimpiarCampos()

  txtTitulo.Text = ""
  txtAutoria.Text = ""
  txtColeccion.Text = ""
  txtRepositorio.Text = ""

End

' Función para cargar y actualizar la grilla
Public Sub CargarGridAdmin()

  Contenido = m_OnOff_y_Red.meConn.Exec("SELECT * FROM revistas ORDER BY txtRevistaTitulo")
  TableViewAdministracion.Rows.Count = Contenido.Count
  TableViewAdministracion.Refresh()

End

' Evento que se ejecuta para cada celda del TableView
Public Sub TableViewAdministracion_Data(Row As Integer, Column As Integer)

  If (Contenido <> Null) Then
    If Row >= 0 Then
      Contenido.moveTo(Row)
      Try TableViewAdministracion.Data.Text = Str(Contenido[Column])
    Endif
  Endif

End

' Evento Click en el TableView - Cargar detalles del registro seleccionado
Public Sub TableViewAdministracion_Click()

  ' Rellenar los campos de texto con los valores de la fila seleccionada
  txtIdAdmin.Text = TableViewAdministracion[TableViewAdministracion.row, 0].Text
  txtTitulo.Text = TableViewAdministracion[TableViewAdministracion.row, 3].Text
  txtAutoria.Text = TableViewAdministracion[TableViewAdministracion.row, 48].Text
  txtColeccion.Text = TableViewAdministracion[TableViewAdministracion.row, 49].Text
  txtRepositorio.Text = TableViewAdministracion[TableViewAdministracion.row, 61].Text

End
