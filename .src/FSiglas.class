' Gambas class file

' EVENTO IMPORTANTE: SE EJECUTA CUANDO EL FORMULARIO SE ABRE
Public Sub Form_Open()

  ' CONFIGURAR EL GRIDVIEW AL ABRIR EL FORMULARIO
  m_Siglas.ConfigurarTableViewGlosarioEnCurso(gvSiglasEnCurso)

  ' INICIALIZAR DATOS
  m_Siglas.IniciarSiglas()

End

' ESTE EVENTO ES CRUCIAL: POBLA CADA CELDA DEL GRIDVIEW
Public Sub gvSiglasEnCurso_Data(Row As Integer, Column As Integer)

  ' VERIFICAR QUE TENEMOS DATOS VÁLIDOS
  If m_Siglas.ContenidoGlo = Null Then Return
  If Row < 0 Or Row >= m_Siglas.ContenidoGlo.Count Then Return

  ' MOVER EL PUNTERO A LA FILA CORRESPONDIENTE
  m_Siglas.ContenidoGlo.MoveTo(Row)

  ' POBLAR LA CELDA CON EL VALOR CORRESPONDIENTE
  Try gvSiglasEnCurso.Data.Text = m_Siglas.ContenidoGlo[Column]

End

Public Sub gvSiglasEnCurso_Click()

  btnNuevoGlosario.Visible = True
  btnGuardarGlosario.Visible = False
  btnGuardarCambiosGlosario.Visible = True
  btnBorrarGlosario.Visible = True

  m_Siglas.MostrarSiglasEnTableViewGlosarioEnCurso(gvSiglasEnCurso.Row)

End

Public Sub btnNuevoGlosario_Click()

  m_Siglas.NuevoGlosario()

End

Public Sub btnGuardarGlosario_Click()

  m_Siglas.GuardarGlosarioPrimeraVez()

End

Public Sub btnGuardarCambiosGlosario_Click()

  m_Siglas.GuardarCambiosSigla()

End

Public Sub btnBorrarGlosario_Click()

  m_Siglas.BorrarGlosario()

End

Public Sub btnAgregarClaveGlosario_Click()

  ' LIMPIAMOS EL TEXTBOX DE LA CLAVE
  txtClaveGlosario.Text = ""

  Dim textoOrigen As String
  textoOrigen = txtNameGlosario.Text

  ' REEMPLAZA CARACTERES PROBLEMÁTICOS
  textoOrigen = Replace(textoOrigen, "´", "")
  textoOrigen = Replace(textoOrigen, "`", "")
  textoOrigen = Replace(textoOrigen, " ", "")
  textoOrigen = Replace(textoOrigen, "á", "a")
  textoOrigen = Replace(textoOrigen, "à", "a")
  textoOrigen = Replace(textoOrigen, "ä", "a")
  textoOrigen = Replace(textoOrigen, "é", "e")
  textoOrigen = Replace(textoOrigen, "è", "e")
  textoOrigen = Replace(textoOrigen, "ë", "e")
  textoOrigen = Replace(textoOrigen, "í", "i")
  textoOrigen = Replace(textoOrigen, "ì", "i")
  textoOrigen = Replace(textoOrigen, "ï", "i")
  textoOrigen = Replace(textoOrigen, "ó", "o")
  textoOrigen = Replace(textoOrigen, "ò", "o")
  textoOrigen = Replace(textoOrigen, "ö", "o")
  textoOrigen = Replace(textoOrigen, "ú", "u")
  textoOrigen = Replace(textoOrigen, "ù", "u")
  textoOrigen = Replace(textoOrigen, "ü", "u")
  textoOrigen = Replace(textoOrigen, "ñ", "n")
  textoOrigen = Replace(textoOrigen, "&", "")
  textoOrigen = Replace(textoOrigen, "ç", "c")
  textoOrigen = Replace(textoOrigen, "{", "")
  textoOrigen = Replace(textoOrigen, "}", "")
  textoOrigen = Replace(textoOrigen, "[", "")
  textoOrigen = Replace(textoOrigen, "]", "")
  textoOrigen = Replace(textoOrigen, "¿", "")
  textoOrigen = Replace(textoOrigen, "?", "")
  textoOrigen = Replace(textoOrigen, "¡", "")
  textoOrigen = Replace(textoOrigen, "!", "")
  textoOrigen = Replace(textoOrigen, "(", "")
  textoOrigen = Replace(textoOrigen, ")", "")
  textoOrigen = Replace(textoOrigen, "-", "")
  textoOrigen = Replace(textoOrigen, "_", "")
  textoOrigen = Replace(textoOrigen, "'", "")
  textoOrigen = Replace(textoOrigen, "#", "")
  textoOrigen = Replace(textoOrigen, "@", "")
  textoOrigen = Replace(textoOrigen, "/", "")
  textoOrigen = Replace(textoOrigen, "°", "")
  textoOrigen = Replace(textoOrigen, "~", "")

  ' CONVIERTE A MINÚSCULAS Y ELIMINA ESPACIOS
  textoOrigen = Trim(LCase(textoOrigen))

  ' CONSTRUYE LA CLAVE
  txtClaveGlosario.Text = "glo" & id_sigla.Text & textoOrigen

End

Public Sub btnMostrarGlosarioDescripcionExtendido_Click()

  f_TXTextendido.OriginalTextBox = txtDescripcionGlosario
  f_TXTextendido.ShowModal

End

Public Sub menuImportar_Click()

  m_Json.ImportarJSONsiglas()
  Wait 1
  m_Siglas.RefrescarTableViewGlosarioEnCurso()

End

Public Sub menuExportar_Click()

  m_Json.ExportarJSONsiglas()

End

Public Sub btnCerrar_Click()

  Me.Close

End
