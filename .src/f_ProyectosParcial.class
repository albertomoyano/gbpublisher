' Gambas class file

' El TableView debe mostrar los proyectos ordenados:
' primero los que se encuentran abiertos indicando usuario que lo posee
' segundo los proyectos activos

Public Sub Form_Open()

  Dim rs As Result
  Dim sSQL As String
  Dim i As Integer
  ' Configurar el TableView
  With TableViewModoParcial
    .Clear
    .Rows.Count = 0
    .Columns.Count = 5  ' Ajusta según tus necesidades
    ' Definir encabezados de columnas
    .Columns[0].Title = "ID"
    .Columns[0].Width = 0
    .Columns[1].Title = "Proyecto"
    .Columns[1].Width = 300
    .Columns[2].Title = "Activo"
    .Columns[2].Width = 0
    .Columns[3].Title = "Ocupado"
    .Columns[3].Width = 80
    .Columns[4].Title = "Tipo"
    .Columns[4].Width = 300
    ' Opcional: más propiedades del TableView
    .Mode = Select.Single  ' Selección simple
    .Header = True         ' Mostrar encabezados
  End With
  ' Consulta: solo proyectos activos
  sSQL = "SELECT * FROM proyectos WHERE activo = 1"
  rs = m_ConexionBD.mConn.Exec(sSQL)

  If rs.Available Then
    TableViewModoParcial.Rows.Count = rs.Count
    ' Llenar el TableView con los datos
    i = 0
    For Each rs
      TableViewModoParcial[i, 0].Text = rs["id"]
      TableViewModoParcial[i, 1].Text = rs["nombre"]
      TableViewModoParcial[i, 2].Text = rs["activo"]

      ' Columna "Tipo" con texto según el valor
      Select Case rs["tipo_producto"]
        Case 1
          TableViewModoParcial[i, 4].Text = "Revista en markdown"
        Case 2
          TableViewModoParcial[i, 4].Text = "Libro en markdown"
        Case 3
          TableViewModoParcial[i, 4].Text = "Libro en LaTeX"
        Default
          TableViewModoParcial[i, 4].Text = "Desconocido"
      End Select

      ' Columna "Ocupado" con color
      If rs["ocupado"] = True Or rs["ocupado"] = 1 Then
        TableViewModoParcial[i, 3].Text = "SÍ"
        TableViewModoParcial[i, 3].Background = Color.RGB(255, 200, 200)  ' Rojo suave
      Else
        TableViewModoParcial[i, 3].Text = "NO"
        TableViewModoParcial[i, 3].Background = Color.RGB(200, 255, 200)  ' Verde suave
      Endif
      i += 1
    Next
  End If
Catch
  Message.Error("Error al obtener los proyectos activos: " & Error.Text)

End

Public Sub ButtonCancelar_Click()

  Me.Close

End
