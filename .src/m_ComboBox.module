' Gambas module file

Public Sub CargarTodosLosComboBox()
  ' CARGA TODOS LOS COMBOBOX DE ARCHIVOS DEL PROYECTO
  ' CENTRALIZA LAS LLAMADAS PARA EVITAR OLVIDOS

  CargarListaArchivosXML()
  CargarListaArchivosFrontMatter()
  CargarListaArchivosBackMatter()

End

Public Sub CargarListaArchivosXML()
  ' CARGA LA LISTA DE ARCHIVOS XML DISPONIBLES EN EL DIRECTORIO DE SALIDAS
  ' LLENA EL COMBOBOX cmbArchivosXML CON LOS ARCHIVOS ENCONTRADOS

  Dim sRutaXML As String
  Dim aArchivos As String[]
  Dim sArchivo As String

  ' LIMPIAR EL COMBOBOX
  FMain.cmbArchivosXML.Clear()

  ' CONSTRUIR RUTA A LA CARPETA DE SALIDAS XML
  sRutaXML = FMain.RutaProyecto &/ "jats"

  ' VERIFICAR QUE EL DIRECTORIO EXISTE
  If Not IsDir(sRutaXML) Then
    Return
  Endif

  ' LISTAR ARCHIVOS .XML EN LA CARPETA
  aArchivos = Dir(sRutaXML, "*.xml")

  ' VERIFICAR QUE HAY ARCHIVOS
  If aArchivos.Count = 0 Then
    Return
  Endif

  ' ORDENAR ALFABÉTICAMENTE
  aArchivos.Sort()

  ' AGREGAR CADA ARCHIVO AL COMBOBOX
  For Each sArchivo In aArchivos
    FMain.cmbArchivosXML.Add(sArchivo)
  Next

  ' SELECCIONAR EL PRIMER ARCHIVO POR DEFECTO
  FMain.cmbArchivosXML.Index = 0

End

Public Sub CargarListaArchivosFrontMatter()
  ' CARGA LA LISTA DE ARCHIVOS MD DISPONIBLES EN EL DIRECTORIO DE SALIDAS
  ' LLENA EL COMBOBOX cmbArchivosFrontMatter CON LOS ARCHIVOS ENCONTRADOS

  Dim sRutaFrontMatter As String
  Dim aArchivos As String[]
  Dim sArchivo As String

  ' LIMPIAR EL COMBOBOX
  FMain.cmbArchivosFrontMatter.Clear()

  ' CONSTRUIR RUTA A LA CARPETA DE SALIDAS XML
  sRutaFrontMatter = FMain.RutaProyecto &/ "front-matter"

  ' VERIFICAR QUE EL DIRECTORIO EXISTE
  If Not IsDir(sRutaFrontMatter) Then
    Return
  Endif

  ' LISTAR ARCHIVOS .XML EN LA CARPETA
  aArchivos = Dir(sRutaFrontMatter, "*.md")

  ' VERIFICAR QUE HAY ARCHIVOS
  If aArchivos.Count = 0 Then
    Return
  Endif

  ' ORDENAR ALFABÉTICAMENTE
  aArchivos.Sort()

  ' AGREGAR CADA ARCHIVO AL COMBOBOX
  For Each sArchivo In aArchivos
    FMain.cmbArchivosFrontMatter.Add(sArchivo)
  Next

  ' SELECCIONAR EL PRIMER ARCHIVO POR DEFECTO
  FMain.cmbArchivosFrontMatter.Index = 0

End

Public Sub CargarListaArchivosBackMatter()
  ' CARGA LA LISTA DE ARCHIVOS MD DISPONIBLES EN EL DIRECTORIO DE SALIDAS
  ' LLENA EL COMBOBOX cmbArchivosBackMatter CON LOS ARCHIVOS ENCONTRADOS

  Dim sRutaBackMatter As String
  Dim aArchivos As String[]
  Dim sArchivo As String

  ' LIMPIAR EL COMBOBOX
  FMain.cmbArchivosBackMatter.Clear()

  ' CONSTRUIR RUTA A LA CARPETA DE SALIDAS XML
  sRutaBackMatter = FMain.RutaProyecto &/ "back-matter"

  ' VERIFICAR QUE EL DIRECTORIO EXISTE
  If Not IsDir(sRutaBackMatter) Then
    Return
  Endif

  ' LISTAR ARCHIVOS .XML EN LA CARPETA
  aArchivos = Dir(sRutaBackMatter, "*.md")

  ' VERIFICAR QUE HAY ARCHIVOS
  If aArchivos.Count = 0 Then
    Return
  Endif

  ' ORDENAR ALFABÉTICAMENTE
  aArchivos.Sort()

  ' AGREGAR CADA ARCHIVO AL COMBOBOX
  For Each sArchivo In aArchivos
    FMain.cmbArchivosBackMatter.Add(sArchivo)
  Next

  ' SELECCIONAR EL PRIMER ARCHIVO POR DEFECTO
  FMain.cmbArchivosBackMatter.Index = 0

End

Public Sub GuardarCambiosFrontMatter()
  ' GUARDA LOS CAMBIOS DEL EDITOR FRONT-MATTER

  Dim sArchivo As String
  Dim sRutaCompleta As String

  ' VERIFICAR QUE HAY ALGO SELECCIONADO
  If FMain.cmbArchivosFrontMatter.Index = -1 Then
    m_Sonido.sonar("Error")
    Message.Warning("No hay ningún archivo seleccionado")
    Return
  Endif

  sArchivo = FMain.cmbArchivosFrontMatter.Text
  sRutaCompleta = FMain.RutaProyecto &/ "front-matter" &/ sArchivo

  ' VERIFICAR QUE EL ARCHIVO EXISTE
  If Not Exist(sRutaCompleta) Then
    m_Sonido.sonar("Error")
    Message.Error("El archivo no existe:" & gb.NewLine & sRutaCompleta)
    Return
  Endif

  ' INTENTAR GUARDAR
  Try File.Save(sRutaCompleta, FMain.txtEditorFrontMatter.Text)
  If Error Then
    m_Sonido.sonar("Error")
    Message.Error("Error al guardar el archivo: " & Error.Text)
    Error.Clear
    Return
  Endif

  m_Sonido.sonar("Info")
  Message.Info("Archivo guardado correctamente.")

End

Public Sub GuardarCambiosBackMatter()
  ' GUARDA LOS CAMBIOS DEL EDITOR BACK-MATTER

  Dim sArchivo As String
  Dim sRutaCompleta As String

  ' VERIFICAR QUE HAY ALGO SELECCIONADO
  If FMain.cmbArchivosBackMatter.Index = -1 Then
    m_Sonido.sonar("Error")
    Message.Warning("No hay ningún archivo seleccionado")
    Return
  Endif

  sArchivo = FMain.cmbArchivosBackMatter.Text
  sRutaCompleta = FMain.RutaProyecto &/ "back-matter" &/ sArchivo

  ' VERIFICAR QUE EL ARCHIVO EXISTE
  If Not Exist(sRutaCompleta) Then
    m_Sonido.sonar("Error")
    Message.Error("El archivo no existe:" & gb.NewLine & sRutaCompleta)
    Return
  Endif

  ' INTENTAR GUARDAR
  Try File.Save(sRutaCompleta, FMain.txtEditorBackMatter.Text)
  If Error Then
    m_Sonido.sonar("Error")
    Message.Error("Error al guardar el archivo: " & Error.Text)
    Error.Clear
    Return
  Endif

  m_Sonido.sonar("Info")
  Message.Info("Archivo guardado correctamente.")

End
